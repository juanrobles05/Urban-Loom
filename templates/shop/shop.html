{% extends 'base.html' %}
{% load static %}
{% load price_filters %}

{% block title %}{{ t.SHOP_TITLE }} - Urban Loom{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/shop.css' %}">
{% endblock %}

{% block content %}
<div class="min-h-screen bg-black text-white">
    <!-- Hero Section -->
    <section class="relative overflow-hidden" style="background: linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #000000 100%);">
        <div class="absolute inset-0 opacity-20" style="background-image: url('data:image/svg+xml,<svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 100 100&quot;><defs><pattern id=&quot;grid&quot; width=&quot;8&quot; height=&quot;8&quot; patternUnits=&quot;userSpaceOnUse&quot;><path d=&quot;M 8 0 L 0 0 0 8&quot; fill=&quot;none&quot; stroke=&quot;#333&quot; stroke-width=&quot;0.3&quot;/></pattern></defs><rect width=&quot;100&quot; height=&quot;100&quot; fill=&quot;url(#grid)&quot;/></svg>');"></div>
        <div class="relative container mx-auto px-6 py-24">
            <div class="max-w-5xl mx-auto text-center">
                <div class="mb-8">
                    <span class="inline-block bg-white/10 backdrop-blur-sm px-4 py-2 rounded-full text-sm font-bold tracking-wider uppercase text-gray-300 border border-white/20">
                        {{ t.SHOP_PREMIUM_COLLECTION }}
                    </span>
                </div>
                <h1 class="text-6xl md:text-8xl font-bold mb-8 tracking-tight shop-title-gradient">
                    {{ t.SHOP_HEADER|upper }}
                </h1>
                <p class="text-xl md:text-2xl text-gray-300 leading-relaxed max-w-3xl mx-auto mb-12">
                    {{ t.SHOP_DESCRIPTION }}
                </p>
                <div class="flex justify-center items-center space-x-8 text-sm text-gray-400">
                    <div class="flex items-center">
                        <div class="w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"></div>
                        <span>{{ products.count }} {{ t.SHOP_PRODUCTS_AVAILABLE }}</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-2 h-2 bg-blue-500 rounded-full mr-2"></div>
                        <span>{{ t.SHOP_FREE_SHIPPING }}</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content with Sidebar -->
    <section class="bg-black mt-12 lg:mt-24">
        <div class="container mx-auto px-6">
            <div class="flex flex-col lg:flex-row gap-8 max-w-7xl mx-auto">
                <!-- Sidebar Filters -->
                <div class="lg:w-80 lg:min-h-screen">
                    <div class="sticky top-20 bg-gray-900/50 backdrop-blur rounded-2xl p-6 border border-gray-800">
                        <h3 class="text-xl font-bold text-white mb-6 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z" clip-rule="evenodd"></path>
                            </svg>
                            {{ t.SHOP_FILTERS }}
                        </h3>

                        <form method="GET" class="space-y-6">
                            <!-- Search -->
                            <div>
                                <label class="block text-sm font-bold text-gray-300 mb-3 uppercase tracking-wider">{{ t.SHOP_SEARCH }}</label>
                                <div class="relative">
                                    <input type="text"
                                           name="search"
                                           value="{{ search_query }}"
                                           placeholder="{{ t.SHOP_SEARCH_PLACEHOLDER }}"
                                           class="w-full bg-black/80 border border-gray-700 rounded-xl px-4 py-3 pl-10 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-white/30 focus:border-white/50 transition-all">
                                    <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                    </svg>
                                </div>
                            </div>

                            <!-- Category Filter -->
                            <div>
                                <label class="block text-sm font-bold text-gray-300 mb-3 uppercase tracking-wider">{{ t.SHOP_CATEGORY }}</label>
                                <div class="relative">
                                    <select name="category" class="w-full bg-black/80 border border-gray-700 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-white/30 focus:border-white/50 transition-all appearance-none cursor-pointer">
                                        <option value="">{{ t.SHOP_ALL_CATEGORIES }}</option>
                                        {% for category in categories %}
                                            <option value="{{ category.id }}" {% if category.id|stringformat:"s" == category_filter %}selected{% endif %}>
                                                {{ category.name }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                    <svg class="absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </div>
                            </div>

                            <!-- Collection Filter -->
                            <div>
                                <label class="block text-sm font-bold text-gray-300 mb-3 uppercase tracking-wider">{{ t.SHOP_COLLECTION }}</label>
                                <div class="relative">
                                    <select name="collection" class="w-full bg-black/80 border border-gray-700 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-white/30 focus:border-white/50 transition-all appearance-none cursor-pointer">
                                        <option value="">{{ t.SHOP_ALL_COLLECTIONS }}</option>
                                        {% for collection in collections %}
                                            <option value="{{ collection.id }}" {% if collection.id|stringformat:"s" == collection_filter %}selected{% endif %}>
                                                {{ collection.name }} - {{ collection.season }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                    <svg class="absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </div>
                            </div>

                            <!-- Price Range -->
                            <div>
                                <label class="block text-sm font-bold text-gray-300 mb-3 uppercase tracking-wider">{{ t.SHOP_PRICE_RANGE }}</label>
                                <div class="grid grid-cols-2 gap-3">
                                    <div class="relative">
                                        <input type="number"
                                               name="min_price"
                                               value="{{ min_price }}"
                                               placeholder="{{ t.SHOP_MIN }}"
                                               class="w-full bg-black/80 border border-gray-700 rounded-xl pl-10 pr-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-white/30 focus:border-white/50 transition-all">
                                        <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none">$</span>
                                    </div>


                                    <div class="relative">
                                        <input type="number"
                                               name="max_price"
                                               value="{{ max_price }}"
                                               placeholder="{{ t.SHOP_MAX }}"
                                               class="w-full bg-black/80 border border-gray-700 rounded-xl pl-10 pr-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-white/30 focus:border-white/50 transition-all">
                                        <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none">$</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Stock Filter -->
                            <div>
                                <label class="block text-sm font-bold text-gray-300 mb-3 uppercase tracking-wider">{{ t.SHOP_AVAILABILITY }}</label>
                                <div class="relative">
                                    <select name="stock" class="w-full bg-black/80 border border-gray-700 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-white/30 focus:border-white/50 transition-all appearance-none cursor-pointer">
                                        <option value="">{{ t.SHOP_ALL_ITEMS }}</option>
                                        <option value="in_stock" {% if stock_filter == 'in_stock' %}selected{% endif %}>{{ t.SHOP_IN_STOCK }}</option>
                                        <option value="out_of_stock" {% if stock_filter == 'out_of_stock' %}selected{% endif %}>{{ t.SHOP_OUT_OF_STOCK }}</option>
                                    </select>
                                    <svg class="absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </div>
                            </div>

                            <!-- Sort -->
                            <div>
                                <label class="block text-sm font-bold text-gray-300 mb-3 uppercase tracking-wider">{{ t.SHOP_SORT_BY }}</label>
                                <div class="relative">
                                    <select name="sort" class="w-full bg-black/80 border border-gray-700 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-white/30 focus:border-white/50 transition-all appearance-none cursor-pointer">
                                        <option value="name" {% if sort_by == 'name' %}selected{% endif %}>{{ t.SHOP_SORT_NAME }}</option>
                                        <option value="price_low" {% if sort_by == 'price_low' %}selected{% endif %}>{{ t.SHOP_SORT_PRICE_LOW }}</option>
                                        <option value="price_high" {% if sort_by == 'price_high' %}selected{% endif %}>{{ t.SHOP_SORT_PRICE_HIGH }}</option>
                                        <option value="newest" {% if sort_by == 'newest' %}selected{% endif %}>{{ t.SHOP_SORT_NEWEST }}</option>
                                        <option value="oldest" {% if sort_by == 'oldest' %}selected{% endif %}>{{ t.SHOP_SORT_OLDEST }}</option>
                                    </select>
                                    <svg class="absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="space-y-3 pt-4 border-t border-gray-700">
                                <button type="submit" class="w-full bg-white text-black py-3 font-bold rounded-xl hover:bg-gray-200 transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-white/30">
                                    {{ t.SHOP_APPLY_FILTERS|upper }}
                                </button>
                                <a href="{% url 'catalog:shop' %}" class="block w-full text-center bg-gray-800/80 text-white py-3 font-medium rounded-xl hover:bg-gray-700 transition-all duration-300 border border-gray-700 hover:border-gray-600">
                                    {{ t.SHOP_CLEAR_ALL|upper }}
                                </a>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Main Content Area -->
                <div class="flex-1">
                    <!-- Results Summary -->
                    <div class="bg-gray-900 border border-gray-800 rounded-2xl p-6 mb-8">
                        <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                            <div class="flex items-center space-x-6">
                                <div class="text-white">
                                    {% if search_query %}
                                        <span class="text-gray-400">{{ t.SHOP_RESULTS_FOR }} </span>
                                        <span class="bg-white/10 px-3 py-1 rounded-full text-white font-medium">"{{ search_query }}"</span>
                                    {% endif %}
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                                    <span class="text-white font-bold text-lg">{{ products.count }}</span>
                                    <span class="text-gray-400">{{ t.SHOP_PRODUCTS_FOUND }}</span>
                                </div>
                            </div>

                            {% if search_query or category_filter or collection_filter or min_price or max_price or stock_filter %}
                                <div class="flex items-center space-x-2 bg-blue-500/10 px-4 py-2 rounded-full border border-blue-500/30">
                                    <svg class="w-4 h-4 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span class="text-blue-400 text-sm font-medium">{{ t.SHOP_FILTERS_ACTIVE }}</span>
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Products Grid -->
                    {% if products %}
                        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                            {% for product in products %}
                                <a href="{% url 'catalog:product_detail' product.id %}" class="group block h-full">
                                    <div class="group bg-gray-900 rounded-lg overflow-hidden shadow-xl transition-all duration-500 transform hover:-translate-y-2 h-full flex flex-col">
                                        <!-- Product Image (fixed height) -->
                                        <div class="relative overflow-hidden rounded-t-lg h-80 shrink-0">
                                            {% if product.image %}
                                                <img src="{{ product.image.url }}"
                                                     alt="{{ product.name }}"
                                                     class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
                                            {% else %}
                                                <div class="w-full h-full bg-gray-800 flex items-center justify-center transition-transform duration-500 group-hover:scale-110">
                                                    <img src="{% static 'img/Logo.png' %}"
                                                         alt="Urban Loom Logo"
                                                         class="w-24 h-24 object-contain opacity-60">
                                                </div>
                                            {% endif %}

                                            <div class="absolute inset-0 bg-black bg-opacity-40 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center">
                                                <span class="text-white text-lg font-bold">{{ t.SHOP_VIEW_PRODUCT|upper }}</span>
                                            </div>

                                            <!-- Status Badge placeholder handled below -->

                                            <!-- Wishlist Button -->
                                            <form method="post" action="{% url 'recommendations:add_to_wishlist' product.id %}" class="inline-block absolute top-4 left-4 z-10">
                                                {% csrf_token %}
                                                <button type="submit" class="hover:bg-primary/10 rounded-full p-2" aria-label="{{ t.WISHLIST_ADD_TO_WISHLIST }}">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                      <path d="M12 6.00019C10.2006 3.90317 7.19377 3.2551 4.93923 5.17534C2.68468 7.09558 2.36727 10.3061 4.13778 12.5772C5.60984 14.4654 10.0648 18.4479 11.5249 19.7369C11.6882 19.8811 11.7699 19.9532 11.8652 19.9815C11.9483 20.0062 12.0393 20.0062 12.1225 19.9815C12.2178 19.9532 12.2994 19.8811 12.4628 19.7369C13.9229 18.4479 18.3778 14.4654 19.8499 12.5772C21.6204 10.3061 21.3417 7.07538 19.0484 5.17534C16.7551 3.2753 13.7994 3.90317 12 6.00019Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                </button>
                                            </form>
                                        </div>

                                        <!-- Product Info (flex to equalize card heights) -->
                                        <div class="p-6 space-y-4 flex-1 flex flex-col justify-between">
                                            <div class="flex justify-between items-start">
                                                <h3 class="text-lg font-bold text-white group-hover:text-gray-200 transition-colors line-clamp-2 flex-1 mr-3">{{ product.name }}</h3>
                                                <div class="text-right">
                                                    <span class="text-2xl font-bold price-gradient">{{ product.price|format_cop }}</span>
                                                </div>
                                            </div>

                                            {% if product.description %}
                                                <p class="text-gray-400 text-sm line-clamp-2 leading-relaxed">{{ product.description|truncatewords:12 }}</p>
                                            {% endif %}

                                            <!-- Collection and Category Tags -->
                                            <div class="flex flex-wrap gap-2">
                                                {% if product.collection %}
                                                    <span class="inline-block bg-blue-500/20 text-blue-300 px-3 py-1 text-xs font-medium rounded-full border border-blue-500/30">
                                                        {{ product.collection.name }}
                                                    </span>
                                                {% endif %}
                                                {% if product.category %}
                                                    <span class="inline-block bg-purple-500/20 text-purple-300 px-3 py-1 text-xs font-medium rounded-full border border-purple-500/30">
                                                        {{ product.category.name }}
                                                    </span>
                                                {% endif %}
                                            </div>

                                            <!-- Stock Status -->
                                            <div class="flex justify-between items-center pt-3 border-t border-gray-700">
                                                {% if product.stock > 0 %}
                                                    <div class="flex items-center space-x-2">
                                                        <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                                        <span class="text-green-400 text-sm font-medium">{{ product.stock }} {{ t.SHOP_IN_STOCK }}</span>
                                                    </div>
                                                {% else %}
                                                    <div class="flex items-center space-x-2">
                                                        <div class="w-2 h-2 bg-red-500 rounded-full"></div>
                                                        <span class="text-red-400 text-sm font-medium">{{ t.SHOP_OUT_OF_STOCK }}</span>
                                                    </div>
                                                {% endif %}

                                                <div class="text-xs text-gray-500">
                                                    {{ product.created_at|date:"M d" }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            {% endfor %}
                        </div>
                    {% else %}
                        <!-- Enhanced Empty State -->
                        <div class="text-center py-24">
                            <div class="max-w-md mx-auto">
                                <div class="relative mb-8">
                                    <svg class="w-32 h-32 text-gray-600 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M9 5l7 7-7 7"></path>
                                    </svg>
                                </div>
                                <h3 class="text-3xl font-bold text-gray-300 mb-4">{{ t.SHOP_NO_PRODUCTS }}</h3>
                                <p class="text-gray-500 mb-8 leading-relaxed">
                                    {% if search_query %}
                                        {{ t.SHOP_NO_PRODUCTS_SEARCH_DESC_1 }} "<span class="text-white font-medium">{{ search_query }}</span>". <br>
                                        {{ t.SHOP_NO_PRODUCTS_SEARCH_DESC_2 }}
                                    {% else %}
                                        {{ t.SHOP_NO_PRODUCTS_FILTER_DESC }}
                                    {% endif %}
                                </p>
                                <div class="space-y-4">
                                    <a href="{% url 'catalog:shop' %}" class="inline-block bg-white text-black px-8 py-4 font-bold rounded-xl hover:bg-gray-200 transition-all duration-300 transform hover:scale-105 shadow-xl">
                                        {{ t.SHOP_VIEW_ALL_PRODUCTS|upper }}
                                    </a>
                                    <br>
                                    <a href="{% url 'catalog:collections' %}" class="inline-block text-gray-400 hover:text-white transition-colors text-sm font-medium">
                                        {{ t.SHOP_BROWSE_COLLECTIONS }}
                                    </a>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </section>
</div>
{% endblock %}
